<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"
      vocab="http://schema.org/" typeof="Blog">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>zeitkraut – How to configure zsh with vi bindings and nice shortcuts</title>
    <link rel="canonical" href="https://zeitkraut.de/posts/2014-06-29-howto-zsh-vi-style.html" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/img/zeitlens-logo-default.svg" />
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="/css/zeitlens.css" />
    <link rel="author"     href="/contact.html#albertkrewinkel" />
    <link property="image" href="/img/zeitlens-logo-default.svg" />
    <link rel="apple-touch-icon" href="/img/zeitlens-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/img/zeitlens-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/img/zeitlens-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/img/zeitlens-icon-144x144.png" />
    <link rel="alternate"  href="/atom.xml" title="ATOM"
          type="application/atom+xml" />
    <script type="text/javascript" async="async" src="/scripts/zeitlens.js"></script>
  </head>
  <body>
    <div id="wrap">
      <div id="header">

        <nav id="navbar" class="navbar navbar-fixed-top" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-exl-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="fa fa-bars"></span>
              </button>
              <a href="/">
                <div class="navbar-brand">
                  <!-- ZeitKraut logo -->
                  <div class="logo inline-logo" id="brand-logo"><svg viewBox="0 0 212 212"
     xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    
  </defs>
  <rect class="logo-background"
        width="100%"
        height="100%" />
  <g transform="translate(100 100)">
    <!-- hours -->
    <g class="logo-hour-dial" transform="rotate(310)">
      <rect class="dial"
            x="-11"
            y="-50"
            width="22"
            height="50"
            ry="16px"/>
    </g>
    <!-- minutes -->
    <g class="logo-minute-dial" transform="rotate(60)">
      <rect class="dial"
            x="-10"
            y="-70"
            width="20"
            height="70"
            ry="14px"/>
    </g>
    <!-- seconds -->
    <g class="logo-second-dial" transform="rotate(200)">
      <circle class="centerpiece"
              cx="0"
              cy="0"
              r="2"/>
      <rect class="dial"
            x="-2"
            y="-73"
            width="4"
            height="73"
            ry="5px"/>
    </g>
    <!-- clock center -->
    <circle class="logo-centerpiece"
            cx="0"
            cy="0"
            r="15"/>
  </g>
  <g class="logo-lupe"
     transform="translate(100 100) rotate(45)">
    <!-- lens -->
    <circle class="logo-lens"
            cx="0"
            cy="0"
            r="86"
            fill="none"
            stroke-width="26px" />
    <!-- handle -->
    <rect class="logo-handle"
          x="90"
          y="-30px"
          width="40"
          height="60px"
          rx="5px"/>
  </g>
  
</svg>
</div>
                  zeitkraut
                </div>
              </a>
            </div>
            <div class="collapse navbar-collapse navbar-exl-collapse">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="/archive.html">Archive</a></li>
                <li><a href="/tags.html">Tags</a></li>
                <li><a href="/colophon.html">Colophon</a></li>
                <li><a href="/privacy-policy.html">Privacy Policy</a></li>
              </ul>
            </div>
          </div>
        </nav>

        <div id="headerImageContainer">
          <img id="headerImg" src="/img/header_400x129.jpg" class="img-responsive" alt="" />
        </div>
      </div>

      <div id="content" class="container">
        <article vocab="http://schema.org/" typeof="BlogPosting">
  <h1 property="headline">How to configure zsh with vi bindings and nice shortcuts</h1>

  <div class="post-metadata">
    <div class="post-date">
      <time datetime="2014-06-29" property="datePublished">June 29, 2014</time>
    </div>
    <div class="post-tags">tagged with: <a href="/tags/zsh.html">zsh</a>, <a href="/tags/vi.html">vi</a>, <a href="/tags/prompt.html">prompt</a>, <a href="/tags/key%20bindings.html">key bindings</a>, <a href="/tags/customization.html">customization</a></div>
  </div>

  <div property="articleBody">
    <p>Having a good working environment is vital for feeling comfortable being productive. This extends to computational tools and the <a href="https://en.wikipedia.org/wiki/command shell">command shell</a> is an integral part of the daily work for many of us. It’s a good idea to configure the shell’s interface to be efficient and pleasant to use. Here we see how <code>zsh</code>, arguably the best shell around, can be configured to suit the needs of people used to vi key bindings (which are arguably arguably superior and more ergonomical than the default emacs-style bindings)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<h2 id="using-vi-bindings-in-the-shell">Using vi-bindings in the shell</h2>
<p>The first step towards nice vi key bindings is almost too easy: The red pill takes the form of</p>
<div class="sourceCode" id="cb1" data-org-language="sh"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">bindkey</span> -v</a></code></pre></div>
<p>Type it into your prompt (and add it to your <code>.zshrc</code> file) and emacs bindings are going bye-bye. <code>Escape</code> will bring you to normal-mode, while <code>i</code>, <code>a</code>, <code>o</code> etc. will bring you back to insert-mode, just as with your favorite editor. Use <code>j</code> and <code>k</code> in normal-mode to go through your history and move around within the line with <code>h</code>, <code>l</code>, <code>w</code>, <code>b</code> and the like.</p>
<p>This is a good start, let’s see how we can bring it from “this is nice” to “that’s just awesome”.</p>
<p>First, we may want to keep some of the default key bindings in insert-mode since we’ve grown accustomed to them. No missing out, let’s put them back in:</p>
<div class="sourceCode" id="cb2" data-org-language="sh"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Kill input from the current point to the end of line with Ctrl-k</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="ex">bindkey</span> <span class="st">&#39;^k&#39;</span> kill-line</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># Search the history incremantally with Ctrl-r</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="ex">bindkey</span> <span class="st">&#39;^r&#39;</span> history-incremental-search-backward</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co"># Insert and go through the &quot;last words&quot; of previous commands with Meta-.</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># (or Escape-. for that matter).</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="ex">bindkey</span> <span class="st">&#39;^[.&#39;</span> insert-last-word</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co"># Show the man-page or other helpful infos with Meta-h</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="ex">bindkey</span> <span class="st">&#39;^[h&#39;</span> run-help</a></code></pre></div>
<p>You can take a look at the key bindings defined for emacs-mode by typing <code>bindkey -M emacs -L</code> and reuse the bindings you like. See the <code>zshzle</code> manpage for more pre-defined widgets for which you could define bindings.</p>
<h2 id="configuring-the-prompt-to-show-the-current-editing-mode">Configuring the prompt to show the current editing mode</h2>
<p>So the key bindings are quite usable now, but it’s a bit unfortunate that it is impossible to see if the shell is in insert- or normal-mode. There should be a mode indicator right in the shell prompt!</p>
<div class="sourceCode" id="cb3" data-org-language="sh"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># You may already have those in your .zshrc somewhere</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="ex">autoload</span> -U promptinit <span class="kw">&amp;&amp;</span> <span class="ex">promptinit</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="ex">autoload</span> -U colors     <span class="kw">&amp;&amp;</span> <span class="ex">colors</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="ex">setopt</span> prompt_subst</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"># Set the colors to your liking</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="bu">local</span> <span class="va">vi_normal_marker=</span><span class="st">&quot;[%{</span><span class="va">$fg[green]</span><span class="st">%}%BN%b%{</span><span class="va">$reset_color</span><span class="st">%}]&quot;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="bu">local</span> <span class="va">vi_insert_marker=</span><span class="st">&quot;[%{</span><span class="va">$fg[cyan]</span><span class="st">%}%BI%b%{</span><span class="va">$reset_color</span><span class="st">%}]&quot;</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="bu">local</span> <span class="va">vi_unknown_marker=</span><span class="st">&quot;[%{</span><span class="va">$fg[red]</span><span class="st">%}%BU%b%{</span><span class="va">$reset_color</span><span class="st">%}]&quot;</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="bu">local</span> <span class="va">vi_mode=</span><span class="st">&quot;</span><span class="va">$vi_insert_marker</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="fu">vi_mode_indicator ()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">  <span class="kw">case</span> <span class="va">${KEYMAP}</span><span class="kw"> in</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="kw">(</span>vicmd<span class="kw">)</span>      <span class="bu">echo</span> <span class="va">$vi_normal_marker</span> <span class="kw">;;</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">    <span class="kw">(</span><span class="ex">main</span><span class="kw">|</span><span class="ex">viins</span><span class="kw">)</span> <span class="bu">echo</span> <span class="va">$vi_insert_marker</span> <span class="kw">;;</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">    <span class="kw">(</span><span class="ex">*</span><span class="kw">)</span>          <span class="bu">echo</span> <span class="va">$vi_unknown_marker</span> <span class="kw">;;</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">  <span class="kw">esac</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="kw">}</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co"># Reset mode-marker and prompt whenever the keymap changes</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="kw">function</span><span class="fu"> zle-line-init</span> <span class="ex">zle-keymap-select</span> {</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">  <span class="va">vi_mode=</span><span class="st">&quot;</span><span class="va">$(</span><span class="ex">vi_mode_indicator</span><span class="va">)</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23">  <span class="ex">zle</span> reset-prompt</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="ex">zle</span> -N zle-line-init</a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="ex">zle</span> -N zle-keymap-select</a>
<a class="sourceLine" id="cb3-27" data-line-number="27"></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="co"># Multiline-prompts don&#39;t quite work with reset-prompt; we work around this by</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="co"># printing the first line(s) via a precmd which is executed before the prompt</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="co"># is printed.  The following can be integrated into PROMPT for single-line</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="co"># prompts.</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"><span class="co">#</span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="co"># Colorize freely</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34"><span class="bu">local</span> <span class="va">user_host=</span><span class="st">&#39;%B%n%b@%m&#39;</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="bu">local</span> <span class="va">current_dir=</span><span class="st">&#39;%~&#39;</span></a>
<a class="sourceLine" id="cb3-36" data-line-number="36"><span class="fu">precmd ()</span> <span class="ex">print</span> -rP <span class="st">&quot;</span><span class="va">${user_host}</span><span class="st"> </span><span class="va">${current_dir}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37"></a>
<a class="sourceLine" id="cb3-38" data-line-number="38"><span class="bu">local</span> <span class="va">return_code=</span><span class="st">&quot;%(?..%{</span><span class="va">$fg[red]</span><span class="st">%}%? %{</span><span class="va">$reset_color</span><span class="st">%})&quot;</span></a>
<a class="sourceLine" id="cb3-39" data-line-number="39"><span class="va">PROMPT=</span><span class="st">&#39;${return_code}${vi_mode} %# &#39;</span></a></code></pre></div>
<p>This gives a prompt in the style of</p>
<pre><code>user@host /current/working/path
[I] %
</code></pre>
<p>where <code>[I]</code> is the insert-mode indicator and is changed to <code>[N]</code> when normal-mode is activated. Neat, isn’t it?</p>
<h2 id="single--and-multi-key-shortcuts">Single- and multi-key shortcuts</h2>
<p>This is all nice and dandy, but it’s not quite like vim yet. How about those sweet bindings where pressing <code>jj</code> in quick succession brings us to normal-mode without having to press <code>Esc</code>? Setting it up is easy as pie.</p>
<div class="sourceCode" id="cb5" data-org-language="sh"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Time in which two keys have to be pressed in order to be recognized as a</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co"># single command (in centiseconds, set to 0.4 sec by default -- may be</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># modified as needed).</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="bu">export</span> <span class="va">KEYTIMEOUT=</span>40</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="ex">bindkey</span> <span class="st">&#39;jj&#39;</span> vi-cmd-mode</a></code></pre></div>
<p>We can also add two-key bindings to jump to the start and end of the line:</p>
<div class="sourceCode" id="cb6" data-org-language="sh"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># Bind to both possible orders in which the keys could be pressed.</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co"># Move all the way to the left</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="ex">bindkey</span> <span class="st">&#39;;l&#39;</span> end-of-line</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="ex">bindkey</span> <span class="st">&#39;l;&#39;</span> end-of-line</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co"># Move all the way to the right</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="ex">bindkey</span> <span class="st">&#39;;h&#39;</span> beginning-of-line</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="ex">bindkey</span> <span class="st">&#39;h;&#39;</span> beginning-of-line</a></code></pre></div>
<p>Jumping to the beginning of the line is now as easy as pressing <code>;</code> and <code>h</code> at the same time. No need to switch to normal-mode and your fingers don’t leave the your keyboard’s home-row. Try it, it’s great!</p>
<h2 id="more">More</h2>
<p>Customizations like this can make it much more pleasant to use the command line and boost your productivity. If the above is still not enough, here are some more ideas:</p>
<ul>
<li>Define custom keymaps, e.g. to control other programs such as <code>mpc</code> or <code>tmux</code>.</li>
<li>Switch to said keymaps via some nice bindings.</li>
<li>Show the status of version control systems and build environments in the prompt.</li>
</ul>
<p>If you don’t feel like doing all the work yourself, I can heartly reommend you take a look at <a href="http://ohmyz.sh">oh-my-zsh</a>. It offers a great collection of ideas to build on and some really cool ready-to-use plugins. Have fun!</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Emacs is a great program which I’ve been using for years and continue to use daily, but vi bindings just make good things better. Thanks to <a href="https://gitorious.org/evil/pages/Home">evil,</a> that’s not a problem.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</section>
  </div>
</article>

      </div>
    </div>

    <footer>
      <div class="container"
           vocab="http://purl.org/dc/terms/">
        <div id="copyright-info">
          <span class="inline-logo"><svg viewBox="0 0 212 212"
     xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    
  </defs>
  <rect class="logo-background"
        width="100%"
        height="100%" />
  <g transform="translate(100 100)">
    <!-- hours -->
    <g class="logo-hour-dial" transform="rotate(310)">
      <rect class="dial"
            x="-11"
            y="-50"
            width="22"
            height="50"
            ry="16px"/>
    </g>
    <!-- minutes -->
    <g class="logo-minute-dial" transform="rotate(60)">
      <rect class="dial"
            x="-10"
            y="-70"
            width="20"
            height="70"
            ry="14px"/>
    </g>
    <!-- seconds -->
    <g class="logo-second-dial" transform="rotate(200)">
      <circle class="centerpiece"
              cx="0"
              cy="0"
              r="2"/>
      <rect class="dial"
            x="-2"
            y="-73"
            width="4"
            height="73"
            ry="5px"/>
    </g>
    <!-- clock center -->
    <circle class="logo-centerpiece"
            cx="0"
            cy="0"
            r="15"/>
  </g>
  <g class="logo-lupe"
     transform="translate(100 100) rotate(45)">
    <!-- lens -->
    <circle class="logo-lens"
            cx="0"
            cy="0"
            r="86"
            fill="none"
            stroke-width="26px" />
    <!-- handle -->
    <rect class="logo-handle"
          x="90"
          y="-30px"
          width="40"
          height="60px"
          rx="5px"/>
  </g>
  
</svg>
</span>
          <span property="title">ZeitKraut</span>,
          <span class="copyright-notice">
            Copyright © 2013–2018
            <a href="/contact.html#content"
               property="http://creativecommons.org/ns#attributionName"
               rel="http://creativecommons.org/ns#attributionURL">Albert
               Krewinkel</a>.
          </span>
        </div>
        <div id="legal-info">
          Text is available under the
          <a rel="license"
             href="http://creativecommons.org/licenses/by-sa/3.0/de/deed.en_US">
            <abbr title="Creative Commons Attribution-ShareAlike 3.0 Germany">
              CC BY‑SA 3.0 DE</abbr></a> license.
        </div>
        <div id="feed-and-code">
          Read the <a href="/atom.xml">feed <span class="fa fa-rss"></span></a> or
          grab the
          <a href="https://github.com/tarleb/zeitkraut-blog"
             >code <span class="fa fa-github"></span></a>!
        </div>
      </div>
    </footer>
    <script type="text/javascript" src="/scripts/jquery.min.js"></script>
    <script type="text/javascript" src="/scripts/bootstrap.min.js"></script>
  </body>
</html>
